<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Making an Open Redirect-Prevention PHP Library</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">Making an Open Redirect-Prevention PHP Library</h1><br/>Let's implement a PHP library that will prevent open redirect vulnerability.<br /><br />For this, let's refer to Facebook's Link Shim. First, let's notice the link shim's behavior on the following URLs.<br />1. <a href="https://l.facebook.com/l.php?u=https://facebook.com">https://l.facebook.com/l.php?u=https://oculus.com</a><br />2. <a href="https://l.facebook.com/l.php?u=https://google.com">https://l.facebook.com/l.php?u=https://google.com</a><br />3. <a href="https://l.facebook.com/l.php?u=http://142.250.199.78">https://l.facebook.com/l.php?u=http://142.250.199.78</a> (Google's IP)<br />4. <a href="https://l.facebook.com/l.php?u=https://evilzone.com">https://l.facebook.com/l.php?u=https://evilzone.com</a><br />5. <a href="https://l.facebook.com/l.php?u=https://eVilZoNE.com">https://l.facebook.com/l.php?u=https://eVilZoNE.com</a><br />6. <a href="https://l.facebook.com/l.php?u=https://evilzone.com">https://l.facebook.com/l.php?u=https://subdomain.evilzone.com</a><br />7. <a href="https://l.facebook.com/l.php?u=https://eVilZoNE.com">https://l.facebook.com/l.php?u=</a><a href="https://ⒼⓄⓄⒼⓁⒺ.com">https://ⒼⓄⓄⒼⓁⒺ.com</a><br /><br />In the first one, we can see that the domain “oculus.com” is whitelisted since Oculus is owned by Facebook. <br />For the second annd third one (google.com), we can see that we are shown a warning page. <br /><img src="images/25-1.png" alt="images/25-1.png" /><br />But for the fourth and fifth one (evilzone.com), an error page is shown because evilzone.com is a blacklisted domain from Facebook. In the sixth one, we can see that even subdomain.evilzone.com is blocked, which means that any subdomain of a blacklisted website is automatically blacklisted as well.<br /><img src="images/25-2.png" alt="images/25-2.png" /><br />In the seventh one, we can see that different unicode characters are not handled by Facebook. Facebook automatically classifies links like this as “invalid”<br /><img src="images/25-3.png" alt="images/25-3.png" /><br /><br />Let's notice again the behavior of link shim for the following URLs. All of the urls stated below are different alternative IP address representations:<br />1. <a href="https://l.facebook.com/l.php?u=http://2398799694">https://l.facebook.com/l.php?u=http://2398799694</a><br />2. <a href="https://l.facebook.com/l.php?u=http://021676543516">https://l.facebook.com/l.php?u=http://021676543516</a><br />3. <a href="https://l.facebook.com/l.php?u=http://0x8efac74e">https://l.facebook.com/l.php?u=http://0x8efac74e</a><br />4. <a href="https://l.facebook.com/l.php?u=http://0x8e.0xfa.0xc7.0x4e">https://l.facebook.com/l.php?u=http://0x8e.0xfa.0xc7.0x4e</a><br />5. <a href="https://l.facebook.com/l.php?u=http://0216.0372.0307.0116">https://l.facebook.com/l.php?u=http://0216.0372.0307.0116</a><br />6. <a href="https://l.facebook.com/l.php?u=http://0216.0372.199.78">https://l.facebook.com/l.php?u=http://0216.0372.199.78</a><br />7. <a href="https://l.facebook.com/l.php?u=http://0x8e.0372.199.78">https://l.facebook.com/l.php?u=http://0x8e.0372.199.78</a><br />8. <a href="https://l.facebook.com/l.php?u=http://0x0008e.0x00000000fa.0x000c7.0x00000000000000000000000004e">https://l.facebook.com/l.php?u=http://0x0008e.0x00000000fa.0x000c7.0x00000000000000000000000004e</a><br />9. <a href="https://l.facebook.com/l.php?u=http://000000000000000000000216.00000372.00000000000000000000307.000000000000116">https://l.facebook.com/l.php?u=http://000000000000000000000216.00000372.00000000000000000000307.000000000000116</a><br />10. <a href="https://l.facebook.com/l.php?u=http://[0:0:0:0:0:ffff:142.250.199.78]">https://l.facebook.com/l.php?u=http://[0:0:0:0:0:ffff:142.250.199.78]</a><br />11. <a href="https://l.facebook.com/l.php?u=http://[::ffff:142.250.199.78]">https://l.facebook.com/l.php?u=http://[::ffff:142.250.199.78]</a><br />12. <a href="https://l.facebook.com/l.php?u=http://1.1">https://l.facebook.com/l.php?u=http://1.1</a><br />13. <a href="https://l.facebook.com/l.php?u=http://1.0.1">https://l.facebook.com/l.php?u=http://1.0.1</a><br />14. <a href="https://l.facebook.com/l.php?u=http://142.250.51022">https://l.facebook.com/l.php?u=http://142.250.51022</a><br /><br />Out of all the alternative IP address representations, only the IPv6/IPv4 Address Embedding (Numbers 10 and 11) are not classified as invalid. <br /><br />In summary, here's our findings in Facebook's Link Shim.<br />1. Unicodes like ⒼⓄⓄⒼⓁⒺ.com don't work is invalid.<br />2. Domains are not case sensitive which means evilzone.com and eVilZoNE.com are the same.<br />3. Only proper IPv4 and IPv6/IPv4 address embedding will work. Other alternative IP representations are classified as invalid.<br /><br />GIven the following findings, we can now create a flowchart for our PHP library.<br /><br /><img src="images/25-4.png" alt="images/25-4.png" /><br /><br />Let's code it! Let's create a function called “validateURL” containing all these steps. This function will return a string with the values of either “invalid”, “blacklisted”, “normal”, “whitelisted”<br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">&lt;?php</span><br /><span style="color:#333333;font-weight:400">$blacklist</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#333333;font-weight:400">[</span><span style="color:#3ad900;font-weight:400">'evilzone.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#3ad900;font-weight:400">'attacker.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#3ad900;font-weight:400">'myphishingsite.com'</span><span style="color:#333333;font-weight:400">]</span><span style="color:#ff9d00;font-weight:400">;</span><br /><span style="color:#333333;font-weight:400">$whitelist</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#333333;font-weight:400">[</span><span style="color:#3ad900;font-weight:400">'facebook.com'</span>&nbsp;<span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#3ad900;font-weight:400">'oculus.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#3ad900;font-weight:400">'thefacebook.net'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#3ad900;font-weight:400">'31.13.87.36'</span><span style="color:#333333;font-weight:400">]</span><span style="color:#ff9d00;font-weight:400">;</span><br /><br /><span style="color:#ff9d00;font-weight:700">function</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$url</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#333333;font-weight:400">[]</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#333333;font-weight:400">[]</span><span style="color:#ff9d00;font-weight:400">)</span>&nbsp;{<br />&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;get&nbsp;hostname&nbsp;(domain&nbsp;or&nbsp;IP&nbsp;address)</span><br />&nbsp;&nbsp;<span style="color:#333333;font-weight:400">$host</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;parse_url<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$url</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;PHP_URL_HOST<span style="color:#ff9d00;font-weight:400">);</span><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;<span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">.</span><span style="color:#3ad900;font-weight:400">'&lt;br&gt;'</span><span style="color:#ff9d00;font-weight:400">;</span><br /><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if(</span>preg_match<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">"/^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$/"</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">))</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;if&nbsp;host&nbsp;is&nbsp;a&nbsp;domain</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">$host</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;strtolower<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">);</span><br />&nbsp;&nbsp;}&nbsp;<span style="color:#ff9d00;font-weight:700">elseif(</span>preg_match<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">))</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;if&nbsp;host&nbsp;is&nbsp;a&nbsp;proper&nbsp;IPv4</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;just&nbsp;fine</span><br />&nbsp;&nbsp;}&nbsp;<span style="color:#ff9d00;font-weight:700">elseif(</span>preg_match<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'/^(\[::ffff:|\[0:0:0:0:0:ffff:)(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\]$/'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">))</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;if&nbsp;host&nbsp;is&nbsp;IPv6/IPv4&nbsp;embedding&nbsp;format</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;get&nbsp;the&nbsp;IPv4&nbsp;part&nbsp;by&nbsp;separating&nbsp;using&nbsp;":"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">$parts</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;explode<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">':'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">$host</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#333333;font-weight:400">$parts[</span>count<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$parts</span><span style="color:#ff9d00;font-weight:400">)</span>&nbsp;<span style="color:#ff9d00;font-weight:400">-</span>&nbsp;<span style="color:#ff0044;font-weight:400">1</span><span style="color:#333333;font-weight:400">]</span><span style="color:#ff9d00;font-weight:400">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;then&nbsp;remove&nbsp;]&nbsp;in&nbsp;the&nbsp;right</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">$host</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;rtrim<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#3ad900;font-weight:400">']&nbsp;'</span><span style="color:#ff9d00;font-weight:400">);</span><br />&nbsp;&nbsp;}&nbsp;<span style="color:#ff9d00;font-weight:700">else</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#3ad900;font-weight:400">'invalid'</span><span style="color:#ff9d00;font-weight:400">;</span><br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;run&nbsp;against&nbsp;the&nbsp;blacklist</span><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for(</span><span style="color:#333333;font-weight:400">$i</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#ff0044;font-weight:400">0</span><span style="color:#ff9d00;font-weight:400">;</span>&nbsp;<span style="color:#333333;font-weight:400">$i</span>&nbsp;<span style="color:#ff9d00;font-weight:400">&lt;</span>&nbsp;count<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;<span style="color:#333333;font-weight:400">$i</span><span style="color:#ff9d00;font-weight:400">++)</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;generate&nbsp;pattern&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;even&nbsp;the&nbsp;subdomains&nbsp;are&nbsp;handled</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">$pattern</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#3ad900;font-weight:400">"/"</span>&nbsp;<span style="color:#ff9d00;font-weight:400">.</span>&nbsp;preg_quote<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$blacklist[$i]</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#3ad900;font-weight:400">"/"</span><span style="color:#ff9d00;font-weight:400">)</span>&nbsp;<span style="color:#ff9d00;font-weight:400">.</span>&nbsp;<span style="color:#3ad900;font-weight:400">'$/'</span><span style="color:#ff9d00;font-weight:400">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;check&nbsp;if&nbsp;the&nbsp;blacklist&nbsp;pattern&nbsp;matches&nbsp;the&nbsp;host</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if(</span>preg_match<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$pattern</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">))</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#3ad900;font-weight:400">'blacklisted'</span><span style="color:#ff9d00;font-weight:400">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;run&nbsp;against&nbsp;the&nbsp;whitelist</span><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">for(</span><span style="color:#333333;font-weight:400">$i</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#ff0044;font-weight:400">0</span><span style="color:#ff9d00;font-weight:400">;</span>&nbsp;<span style="color:#333333;font-weight:400">$i</span>&nbsp;<span style="color:#ff9d00;font-weight:400">&lt;</span>&nbsp;count<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;<span style="color:#333333;font-weight:400">$i</span><span style="color:#ff9d00;font-weight:400">++)</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;generate&nbsp;pattern&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;even&nbsp;the&nbsp;subdomains&nbsp;are&nbsp;handled</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#333333;font-weight:400">$pattern</span>&nbsp;<span style="color:#ff9d00;font-weight:400">=</span>&nbsp;<span style="color:#3ad900;font-weight:400">"/"</span>&nbsp;<span style="color:#ff9d00;font-weight:400">.</span>&nbsp;preg_quote<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$whitelist[$i]</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#3ad900;font-weight:400">"/"</span><span style="color:#ff9d00;font-weight:400">)</span>&nbsp;<span style="color:#ff9d00;font-weight:400">.</span>&nbsp;<span style="color:#3ad900;font-weight:400">'$/'</span><span style="color:#ff9d00;font-weight:400">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;check&nbsp;if&nbsp;the&nbsp;whitelist&nbsp;pattern&nbsp;matches&nbsp;the&nbsp;host</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">if(</span>preg_match<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#333333;font-weight:400">$pattern</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$host</span><span style="color:#ff9d00;font-weight:400">))</span>&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#3ad900;font-weight:400">'whitelisted'</span><span style="color:#ff9d00;font-weight:400">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;if&nbsp;its&nbsp;not&nbsp;blacklisted/whitelisted/invalid,&nbsp;it&nbsp;means&nbsp;the&nbsp;host&nbsp;is&nbsp;normal</span><br />&nbsp;&nbsp;<span style="color:#ff9d00;font-weight:700">return</span>&nbsp;<span style="color:#3ad900;font-weight:400">'normal'</span><span style="color:#ff9d00;font-weight:400">;</span><br />}<br /><span style="color:#ff9d00;font-weight:700">?&gt;</span></div></div><br /><br />Now that we have the validateURL function that accepts the parameters URL (string), blacklist (array of blacklisted domains/ip), and whitelist (arracy of whitelisted domains/IP). We can now check the function using the following code:<br /><br /><div class="codebox"><div class="codebox"><span style="color:#ff9d00;font-weight:700">&lt;?php</span><br /><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'https://google.com/search?q=dog'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'normal'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'https://google.com/'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'normal'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'https://GOOgle.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'normal'</span><br /><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'https://facebook.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'whitelisted'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://facebook.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'whitelisted'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://evilzone.com.facebook.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'whitelisted'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://31.13.87.36'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'whitelisted'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://[::ffff:31.13.87.36]'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'whitelisted'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://[0:0:0:0:0:ffff:31.13.87.36]'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'whitelisted</span><br /><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://evilzone.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'blacklisted'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://subdomain.evilzone.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'blacklisted'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://subdomain.eVILzonE.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'blacklisted'</span><br /><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://2398799694'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://021676543516'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://0x8efac74e'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://0x8e.0xfa.0xc7.0x4e'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://0216.0372.0307.0116'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://0216.0372.199.78'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://0x8e.0372.199.78'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://0x0008e.0x00000000fa.0x000c7.0x00000000000000000000000004e'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://000000000000000000000216.00000372.00000000000000000000307.000000000000116'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://1.1'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://1.0.1'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'http://142.250.51022'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">);</span>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><span style="color:#ff9d00;font-weight:700">echo</span>&nbsp;validateURL<span style="color:#ff9d00;font-weight:400">(</span><span style="color:#3ad900;font-weight:400">'https://ⒼⓄⓄⒼⓁⒺ.com'</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$blacklist</span><span style="color:#ff9d00;font-weight:400">,</span>&nbsp;<span style="color:#333333;font-weight:400">$whitelist</span><span style="color:#ff9d00;font-weight:400">)</span>&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//&nbsp;return&nbsp;'invalid'</span><br /><br /><span style="color:#ff9d00;font-weight:700">?&gt;</span></div></div><br /><br />References:<br /><a href="https://stackoverflow.com/questions/12987126/php-if-ip-or-domain-detect-function">https://stackoverflow.com/questions/12987126/php-if-ip-or-domain-detect-function</a><br /><a href="https://stackoverflow.com/questions/9873144/php-string-to-regex">https://stackoverflow.com/questions/9873144/php-string-to-regex</a></div></body></html>