<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Advance Blacklisting and Whitelisting</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
  
    <script type="text/javascript">
        function in_frame () { try { return window.self !== window.top; } catch (e) { return true; } }
        if (!in_frame()) {
            var page = location.pathname.substring(location.pathname.lastIndexOf("/") + 1);
            window.location = 'index.html#' + page;
        }
    </script>
</head>
<body><div class="page"><h1 class="title">Advance Blacklisting and Whitelisting</h1><br/>Basic blacklisting and whitelisting can be bypassed using several methods. Some of these methods are:<br />    - URL shortening<br />    - Domain Redirection<br />    - Alternative IP representations<br />    - URI Normalization<br />    <br />URL shortening is a processes in which a URL is shorten to make it more readable and sometimes, to bypass (blacklisting) filters as well. Some examples of URL shorteners are:<br />    - tinyurl.com<br />    - shorte.st<br />    - bit.ly<br />    - goo.gl<br />Here is an example of how URL shortening is used to bypass filters. Assuming there is a website called site.com. Site.com disallows the use of the domain ‚Äúattacker.com‚Äù. Using URL shortening form tinyurl.com, the attacker can rewrite this URL to <a href="https://tinyurl.com/2a4brkeh">https://tinyurl.com/2a4brkeh</a> which bypasses the filter since the domain ‚Äútinyurl.com‚Äù is not included in the blacklisted domains.<br /><img src="images/14-1.png" alt="images/14-1.png" /><br /><br />Domain redirection is quite related to URL shortening. URL spoofing works by setting up a domain name (for example is somesafesite.com). The attacker buys this domain from domain registrars such as GoDaddy and NameCheap. Then the attacker configures the somesafesite.com to point to attacker.com. Which means that if a user opens somesafesite.com, he will be automatically redirected to attacker.com.<br />In the image below, using the ‚Äúdig‚Äù command, we can see that the ‚Äúlocalhost.me‚Äù resolves to the IP address of 127.0.0.1. As an attacker, this will be useful if I am trying to bypass the ‚Äú127.0.0.1‚Äù in the blacklist.<br /><br /><img src="images/14-2.png" alt="images/14-2.png" /><br /><br />For the alternative IP address representations, we all know that we can access domains by typing the IP of it. For example, we can open google.com by directly using its IP address of 142.250.199.78. Many of us are aware of this, but only a few is aware of the different IP notations.<br />The http://142.250.199.78 can be rewritten in many ways. Some of them are as follows:<br /><a href="http://2398799694">http://2398799694</a> (Decimal notation)<br /><a href="http://021676543516">http://021676543516</a> (Octal notation)<br /><a href="http://0x8efac74e">http://0x8efac74e</a> (Hexadecimal notation)<br /><a href="http://0x8e.0xfa.0xc7.0x4e">http://0x8e.0xfa.0xc7.0x4e</a> (Full Hexadecimal notation)<br /><a href="http://0216.0372.0307.0116">http://0216.0372.0307.0116</a> (Full Octal notation)<br /><a href="http://0216.0372.199.78">http://0216.0372.199.78</a> (Random notation [octal for the first 2 bytes and decimal for the last 2 bytes])<br /><a href="http://0x8e.0372.199.78">http://0x8e.0372.199.78</a> (Random notation [hex for the first byte, octal for the second byte, and decimal for the last 2 bytes])<br /><a href="http://0x0008e.0x00000000fa.0x000c7.0x00000000000000000000000004e">http://0x0008e.0x00000000fa.0x000c7.0x00000000000000000000000004e</a> (Random padding hexadecimal notation)<br /><a href="http://000000000000000000000216.00000372.00000000000000000000307.000000000000116">http://000000000000000000000216.00000372.00000000000000000000307.000000000000116</a> (Random padding octal notation)<br /><a href="http://[0:0:0:0:0:ffff:142.250.199.78]">http://[0:0:0:0:0:ffff:142.250.199.78]</a> (IPv6/IPv4 Address Embedding)<br /><a href="http://[::ffff:142.250.199.78]">http://[::ffff:142.250.199.78]</a> (IPv6/IPv4 Address Embedding)<br />Aside from this, there are also other ways that involve ‚Äúincomplete‚Äù IP address. If we have a URI of http://1.0.0.1, this can be written as the following:<br /><a href="http://1.1">http://1.1</a> (some zeroes are optional)<br /><a href="http://1.0.1">http://1.0.1</a> (some zeroes are optional)<br />Another example is the Google's IP address of 142.250.199.78, this can be written as:<br /><a href="http://142.250.51022">http://142.250.51022</a> (IP address overflow [the 51022 is just <strong>199</strong>*256+<strong>78</strong>, the last 2 bytes of Google's IP address])<br /><br />The last bypass involves URI normalization. URI normalization is a proccess in which URIs are normalized to its standard form. In simple terms, think that you opened a browser. Then you typed the URL of hTTpS://wWw.gOOgLe.coM/ . Do you think that this will work? Yes, it will.<br />URI normalization is not limited to converting all characters to lowercase equivalent but it also converts other unicode characters to its normalized version. An example of this is:<br /><a href="https://‚íº‚ìÑ‚ìÑ‚íº‚ìÅ‚í∫.com">https://‚íº‚ìÑ‚ìÑ‚íº‚ìÅ‚í∫.com</a><br /><a href="https://‚ìñ‚ìû‚ìû‚ìñ‚ìõ‚ìî.‚ìí‚ìû‚ìú">https://‚ìñ‚ìû‚ìû‚ìñ‚ìõ‚ìî.‚ìí‚ìû‚ìú</a><br /><a href="http://ùì∞ùì∏ùì∏ùì∞ùìµùìÆ.ùì¨ùì∏ùì∂">http://ùì∞ùì∏ùì∏ùì∞ùìµùìÆ.ùì¨ùì∏ùì∂</a> <br /><a href="https://googleÔΩ°com">https://googleÔΩ°com</a> <br /><br />We can see here that there's a lot of bypasses but we will only try to implement a code that handles only the last two bypasses, the alternative IP addresses and URI normalization. This is because the URL shortening and the domain redirection is very hard to check. Why? Because we can shorten a URL for 100 times. We can also implement the domain redirection for 100 times as well, making it very very hard to validate. Even Facebook's url validation (Facebook's linkshim) only implements checking on the alternative IP address notation and URI normalizations.<br />    <br />References:<br /><a href="https://hackerone.com/reports/299130">https://hackerone.com/reports/299130</a><br /><a href="https://hackerone.com/reports/303378">https://hackerone.com/reports/303378</a><br /><a href="https://hackerone.com/reports/299135">https://hackerone.com/reports/299135</a><br /><a href="https://github.com/vysecurity/IPFuscator">https://github.com/vysecurity/IPFuscator</a><br /><a href="https://stackoverflow.com/questions/9340298/uncommon-ip-notations">https://stackoverflow.com/questions/9340298/uncommon-ip-notations</a><br /><a href="https://twitter.com/loosesecurity/status/1331270289733324805?lang=en">https://twitter.com/loosesecurity/status/1331270289733324805?lang=en</a><br /><a href="https://readme.localtest.me/">https://readme.localtest.me/</a><br /><a href="https://portswigger.net/web-security/ssrf">https://portswigger.net/web-security/ssrf</a><br /><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery</a><br /><a href="https://github.com/payloadbox/open-redirect-payload-list/blob/master/README.md">https://github.com/payloadbox/open-redirect-payload-list/blob/master/README.md</a><br /><a href="https://ma.ttias.be/theres-more-than-one-way-to-write-an-ip-address/">https://ma.ttias.be/theres-more-than-one-way-to-write-an-ip-address/</a></div></body></html>